### **Рамки.** Информационная система управления складом.

### **Уровень.** Задача, определённая пользователем.

### **Основной исполнитель.** Кладовщик.

### **Заинтересованные лица и их требования:**

- **Кладовщик.** Хочет быстро и корректно определить место хранения для поступившего товара, основываясь на рекомендациях системы.
- **Менеджер склада.** Должен иметь возможность инициировать определение места хранения (например, при перераспределении) и контролировать корректность размещения.
- **Система учета.** Должна получать точные данные о привязке товаров к ячейкам, включая объём, срок годности и поставщика.

### **Предусловия:**

- Товар уже известен системе (имеет `ProductId`, `SKU`, габариты, категорию).
- В системе настроены зоны и ячейки хранения (`StorageLocation`, `WarehouseSection`) с указанием вместимости и координат.
- Поступившая партия содержит обязательные данные: количество, габариты, срок годности, поставщика.
- Кладовщик или менеджер авторизованы и имеют право инициировать размещение.

### **Результаты (Постусловия):**

- Система возвращает идентификатор подходящей ячейки (`LocationId`).
- Ячейка отмечена как частично или полностью занята.
- Информация о размещении готова к фиксации при регистрации поступления (через `Receipt`).
- Состояние склада обновлено: свободное место уменьшено.

### **Основной успешный сценарий (Определение места хранения товаров):**

1. **Кладовщик** (или **Менеджер склада**) инициирует операцию определения места хранения, передавая данные о товаре и количестве.
2. Система через `StorageLocationAssignmentUseCase` запрашивает у `LocationAssignmentContext` оптимальное место.
3. `LocationAssignmentContext` делегирует выбор стратегии (`LocationAssignmentService`), которая анализирует доступные `StorageLocation`.
4. Система возвращает идентификатор подходящей ячейки (`LocationId`).
5. Результат отображается пользователю или используется при регистрации поступления.

### **Расширения (альтернативные потоки):**

- **3а.** Подходящих ячеек не найдено.
  1. Система возвращает ошибку: «Нет доступных мест, соответствующих требованиям».
  2. Пользователь может запросить расширение зоны хранения или изменить параметры размещения.

- **1а.** Переданы неполные или некорректные данные о товаре.
  1. Система отклоняет запрос с ошибкой валидации (`ValidationResult` из `AssignmentCommand`).
  2. Пользователь исправляет данные и повторяет попытку.

- **4а.** Найденная ячейка временно заблокирована (например, инвентаризация).
  1. Система автоматически ищет следующую подходящую ячейку.
  2. Если альтернатив нет — возвращается ошибка, как в 3а.

### **Специальные требования:**

- Выбор места должен учитывать габариты, вес, срок годности и совместимость категорий.
- Поддержка стратегий размещения: ближайшее место, максимальное заполнение и др.
- Все вызовы должны быть идемпотентными и логироваться для аудита.
- Интерфейс должен возвращать не только `LocationId`, но и человекочитаемые координаты (`LocationCoordinates`).
j
### **Список основных сущностей и данных:**

- **Товар (`Product`)**: `ProductId`, `SKU`, название, категория, `ProductDimensions` (вес, объём).
- **Партия (`InventoryBatch`)**: `BatchId`, `ProductId`, количество, дата получения, срок годности.
- **Ячейка хранения (`StorageLocation`)**: `LocationId`, `LocationCoordinates` (зона, стеллаж, полка), вместимость, занятое пространство.
- **Команда размещения (`AssignmentCommand`)**: габариты, количество, категория (если требуется).
- **Стратегия (`LocationAssignmentService`)**: логика выбора места.

### **Частота использования:**

- Операция вызывается при каждом поступлении товара, а также при переразмещении — от нескольких до сотен раз в день.

### **Открытые вопросы:**

- Должна ли система учитывать температурные зоны или специальные условия хранения?
- Требуется ли поддержка ручного переопределения автоматически предложенного места?
- Нужно ли уведомлять логистику о новых размещениях через интеграции?
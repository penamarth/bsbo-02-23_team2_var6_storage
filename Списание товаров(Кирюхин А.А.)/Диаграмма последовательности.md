```
@startuml
actor Кладовщик

participant UI
participant WarehouseFacade
participant WriteOffService
participant "IGoodsRepository" as IGoodsRepo
participant "GoodsRepository" as GoodsRepo
participant Database
participant "AccountingSystem" as Accounting

Кладовщик -> UI: Выбирает "Списание товаров"
activate UI

UI -> WarehouseFacade: GetAvailableGoods()
activate WarehouseFacade

WarehouseFacade -> IGoodsRepo: GetStockItems()
activate IGoodsRepo

IGoodsRepo -> GoodsRepo: GetStockItems()
activate GoodsRepo

GoodsRepo -> Database: SELECT * FROM goods WHERE quantity > 0
activate Database

Database --> GoodsRepo: List<Good>
deactivate Database

GoodsRepo --> IGoodsRepo: List<Good>
deactivate GoodsRepo

IGoodsRepo --> WarehouseFacade: List<Good>
deactivate IGoodsRepo

WarehouseFacade --> UI: List<Good>
deactivate WarehouseFacade

UI --> Кладовщик: Отображает список товаров

deactivate UI

Кладовщик -> UI: Выбирает товар, указывает количество и причину, подтверждает
activate UI

UI -> WarehouseFacade: CreateWriteOff(userId, goodId, quantity, reason)
activate WarehouseFacade

WarehouseFacade -> WriteOffService: ValidateWriteOff(goodId, quantity)
activate WriteOffService

WriteOffService -> IGoodsRepo: GetStock(goodId)
activate IGoodsRepo

IGoodsRepo -> GoodsRepo: GetStock(goodId)
activate GoodsRepo

GoodsRepo -> Database: SELECT quantity FROM goods WHERE id = goodId
activate Database

Database --> GoodsRepo: currentStock
deactivate Database

GoodsRepo --> IGoodsRepo: currentStock
deactivate GoodsRepo

IGoodsRepo --> WriteOffService: currentStock
deactivate IGoodsRepo

WriteOffService -> WriteOffService: Проверяет stock >= quantity
WriteOffService --> WarehouseFacade: Валидация успешна
deactivate WriteOffService

WarehouseFacade -> IGoodsRepo: UpdateStock(goodId, newStock = currentStock - quantity)
activate IGoodsRepo

IGoodsRepo -> GoodsRepo: UpdateStock(goodId, newStock)
activate GoodsRepo

GoodsRepo -> Database: UPDATE goods SET quantity = newStock WHERE id = goodId
activate Database

Database --> GoodsRepo: affectedRows
deactivate Database

GoodsRepo --> IGoodsRepo: success
deactivate GoodsRepo

IGoodsRepo --> WarehouseFacade: success
deactivate IGoodsRepo

WarehouseFacade -> Accounting: SendWriteOffData(goodId, quantity, reason)
activate Accounting

Accounting --> WarehouseFacade: success
deactivate Accounting

WarehouseFacade -> WarehouseFacade: LogWriteOffOperation(userId, goodId, quantity, reason)

WarehouseFacade --> UI: WriteOffConfirmation
deactivate WarehouseFacade

UI --> Кладовщик: Отображает подтверждение и обновленные остатки
deactivate UI
@enduml
```
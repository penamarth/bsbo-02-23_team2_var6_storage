# Рамки: Приложение информационной системы склада

## Cценарий: Просмотр отчетов о состоянии склада

## Уровень: Задача, определенная пользователем

## Основной исполнитель: Менеджер склада

### Заинтересованные лица и их требования

* **Менеджер склада**

  * Хочет видеть актуальные остатки товаров по складу.
  * Хочет анализировать движение товаров за период (поступления, отгрузки, списания).
  * Хочет быстро находить проблемные позиции (дефицит, излишки, просрочка, товары без движения).
  * Хочет экспортировать отчеты (PDF/Excel) и отправлять их руководству или в бухгалтерию.

* **Кладовщик**

  * Хочет понимать, какие товарные позиции требуют приоритетного внимания (пополнение, перемещение, списание).
  * Хочет видеть отчеты по своим сменам/сменному заданию.

* **Бухгалтерия / финансовый отдел**

  * Хочет получать данные по товарным остаткам в стоимостном выражении.
  * Хочет сверять данные по складу с учетной системой (1С/ERP).

* **Отдел логистики**

  * Хочет понимать текущую загруженность склада и наличие товаров для планирования отгрузок.
  * Хочет видеть прогноз по остаткам и динамике оборота.

* **Компания**

  * Хочет минимизировать складские издержки (излишние остатки, хранение, просрочка).
  * Хочет повышать оборачиваемость товарных запасов.
  * Хочет иметь аналитические данные по складу для управленческих решений.

### Предусловия

* Менеджер склада авторизован в системе.
* У пользователя есть права доступа на просмотр отчетов.
* В системе настроены:

  * номенклатура товаров;
  * структура склада (зоны, стеллажи, ячейки);
  * единицы измерения и типы складских операций (поступление, отгрузка, списание, перемещение).
* В базе данных накоплены данные о движении и остатках товаров.
* Подсистемы:

  * **Система учета** (операции поступления/отгрузки/списания) работают и передают данные в хранилище отчетов.

### Результаты (Постусловия)

* Сформирован и отображен отчет (или несколько отчетов) о состоянии склада в соответствии с параметрами, выбранными менеджером.
* Менеджер видит актуальные данные (на дату/период).
* Пользователь может:

  * изменить параметры отчета и переформировать его;
  * экспортировать отчет;
  * распечатать отчет.
* В системе может быть зафиксирован факт формирования отчета (для аудита и аналитики).


### Основной успешный сценарий

1. **Менеджер в интерфейсе выбирает раздел «Отчеты склада».**

   * Графический интерфейс (UI) отправляет на сервер запрос на получение списка доступных типов отчетов и/или сохранённых шаблонов.

2. **Сервер получает список доступных отчетов для данного пользователя.**

   * Сервер (фасад отчетов склада) обращается к подсистеме прав/ролей, чтобы определить, какие типы отчетов доступны менеджеру.
   * Фасад отчетов обращается к системе хранения настроек отчетов / репозиторию отчетов.
   * Репозиторий делает запрос к базе данных с определением доступных типов отчетов и их параметров.
   * База данных возвращает список определений отчетов (например: «Отчет по остаткам», «Отчет по обороту», «Отчет по просроченным товарам»).

3. **Пользователю отображается список отчетов.**

   * Сервер передает данные о доступных отчетах в UI.
   * UI показывает список отчетов и базовую форму выбора параметров (период, склад, зона склада, группа товаров и т.п.).

4. **Менеджер выбирает тип отчета «Отчет по остаткам» и задает параметры.**

   * Менеджер указывает:

     * период (на дату или интервал);
     * склад/зону/ячейки (по необходимости);
     * фильтры по номенклатуре (группа товаров, конкретный товар, производитель и т.д.).

5. **После заполнения параметров менеджер запускает формирование отчета.**

   * UI отправляет на сервер запрос на формирование отчета с выбранными параметрами.

6. **Сервер формирует отчет.**

   * Фасад отчетов обращается к системе хранения складовых данных / репозиторию отчетов.
   * Репозиторий формирует SQL-запросы/агрегирующие запросы к базе данных (остатки на дату, движение за период, места хранения).
   * База данных возвращает агрегированные данные по остаткам, сгруппированные по товарам, местам хранения, партиям и т.п.
   * Репозиторий формирует объект данных отчета (ReportDataSet / ReportViewModel) и передает его в фасад отчетов.

7. **Пользователю показывается готовый отчет.**

   * Фасад отправляет данные отчета в UI.
   * UI визуализирует отчет (таблица, возможно диаграммы/сводные показатели: всего позиций, общая стоимость, количество позиций ниже минимального остатка и т.п.).
   * Менеджер может пролистывать страницы отчета, использовать сортировку и фильтры на уровне интерфейса.

### Расширения (альтернативные потоки)

#### 1. Менеджер меняет параметры и формирует отчет повторно

> 1. UI отправляет на сервер новые параметры фильтрации (период, склад, номенклатура).
> 2. Фасад отчетов повторно обращается к репозиторию отчетов.
> 3. Репозиторий повторно выполняет запрос к базе данных.
> 4. База данных возвращает обновлённый набор данных.
> 5. Фасад передаёт обновлённый отчет в UI.
> 6. UI повторно отображает отчет с новыми параметрами.

#### 2. Менеджер экспортирует отчет (Excel/PDF)

> 1. Пользователь нажимает кнопку «Экспорт» (выбирает формат).
> 2. UI отправляет запрос на сервер с указанием формата экспорта и параметров текущего отчета.
> 3. Фасад отчетов обращается к сервису генерации файлов отчетов.
> 4. Сервис генерации преобразует данные отчета в нужный формат (Excel/PDF), сохраняет временный файл.
> 5. Сервер возвращает UI ссылку или поток файла.
> 6. UI инициирует скачивание файла пользователю.

#### 3. По заданным параметрам нет данных

> 1. Фасад отчетов формирует и отправляет запрос в базу данных.
> 2. База данных возвращает пустой набор данных.
> 3. Репозиторий возвращает фасаду «пустой отчет» с признаком отсутствия данных.
> 4. Фасад передаёт результат в UI.
> 5. UI отображает пользователю сообщение «По выбранным параметрам данных нет» и пустую структуру отчета.

#### 4. Ошибка при доступе к базе данных или сервисам

> 1. При выполнении запроса к базе данных возникает ошибка соединения/таймаут.
> 2. Репозиторий возвращает фасаду ошибку.
> 3. Фасад логирует ошибку (в систему логирования/мониторинга).
> 4. Фасад возвращает UI информацию о неуспешном формировании отчета с техническими деталями для логов и понятным текстом для пользователя.
> 5. UI показывает пользователю сообщение о невозможности сформировать отчет в данный момент и предложением повторить попытку позже или обратиться к администратору.

### Специальные требования

* Интуитивный интерфейс выбора отчетов и параметров (предустановленные шаблоны, сохранение последних параметров).
* Возможность:

  * сохранять пользовательские шаблоны отчетов;
  * быстро переключаться между временными периодами (сегодня/неделя/месяц/квартал).
* Валидация параметров:

  * корректность периода (дата «с» ≤ дата «по»),
  * корректность выбора склада и фильтров по товарам.
* Логирование:

  * факт доступа к отчетам,
  * параметры формирования,
  * результат (успешно/ошибка/нет данных).
* Поддержка:

  * экспорта в Excel/PDF,
  * печати,
  * выгрузки в другие системы (например, в бухгалтерию).
* Возможность ограничения детализации:

  * агрегированные отчеты (по группам товаров),
  * детализированные отчеты (по партиям/ячейкам).
* Масштабируемость:

  * обработка больших объемов данных,
  * оптимизированные SQL-запросы и индексы для таблиц остатков и движений.

### Список технологий и типов данных

* **Данные товаров**: артикул, SKU, наименование, группа, единица измерения, производитель, минимальный и максимальный остаток.
* **Данные складских остатков**: товар, количество, партия, срок годности, место хранения (зона, стеллаж, ячейка), стоимость.
* **Движения товаров**: тип операции (поступление, отгрузка, списание, перемещение), дата, количество, контрагент, документ-основание.
* **Структура склада**: склады, зоны, стеллажи, ячейки, типы ячеек, вместимость.
* **Отчеты**:

  * определения типов отчетов (id, название, назначение),
  * сохраненные шаблоны (параметры, владелец, дата создания/обновления).
* **Интеграции**:

  * система учета (1С/ERP),
  * возможно – BI/аналитические системы для дальнейшей обработки данных.


### Частота использования

* Просмотр стандартных отчетов по остаткам – **ежедневно**, в начале и конце смены.
* Аналитические отчеты (оборачиваемость, ABC/XYZ анализ) – **еженедельно/ежемесячно**.
* Экспорт отчетов – **регулярно**, при подготовке отчетности для руководства и бухгалтерии.
* Пиковые нагрузки:

  * инвентаризации;
  * отчетные периоды (конец месяца/квартала/года).

### Открытые вопросы

* Какие именно типы отчетов о состоянии склада должны быть в минимальном наборе (остатки, оборот, просрочка, неликвид, ABC/XYZ, загруженность склада и т.п.)?
* Нужна ли детализация до уровня:

  * места хранения (ячейки),
  * партий,
  * серийных номеров?
* Какие форматы экспорта обязательны (XLSX, CSV, PDF)?
* Как долго хранить «снимки» отчетов в системе (для повторного просмотра без пересчета)?
* Требуется ли фоновой режим формирования «тяжелых» отчетов с уведомлением по завершению?
* Какие ограничения по объему данных и времени формирования отчета считаются приемлемыми?

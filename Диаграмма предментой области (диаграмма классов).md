![alt text](./assets/class.svg)

```
@startuml

package "warehouse-management" {
  package "application" {
    package "usecase" {
      class RegisterGoodsReceiptUseCase {
        - receiptRepository: ReceiptRepository
        - locationService: LocationAssignmentService
        - movementService: MovementService
        - outbox: OutboxService
        + execute(command: ReceiptCommand): Result<String>
      }

      class RegisterGoodsShipmentUseCase {
        - shipmentRepository: ShipmentRepository
        - inventoryService: InventoryService
        - movementService: MovementService
        + execute(command: ShipmentCommand): Result<String>
      }

      class RegisterWriteOffUseCase {
        - writeOffRepository: WriteOffRepository
        - inventoryService: InventoryService
        - movementService: MovementService
        + execute(command: WriteOffCommand): Result<String>
      }

      class StorageLocationAssignmentUseCase {
        - locationRepository: LocationRepository
        - assignmentService: LocationAssignmentService
        + assignLocation(command: AssignmentCommand): Result<LocationCoordinates>
      }
    }

    package "dto" {
      class ReceiptCommand {
        - supplier: String
        - items: List<ReceiptItem>
        + validate(): ValidationResult
      }

      class ReceiptItem {
        - productId: ProductCode
        - quantity: double
        - batchNumber: String
        - expiryDate: LocalDate
        - supplier: String
        - receivedAt: LocalDateTime
      }

      class WriteOffCommand {
        - reason: String
        - responsiblePerson: String
        - items: List<WriteOffItem>
        + validate(): ValidationResult
      }

      class WriteOffItem {
        - productId: ProductCode
        - quantity: double
        - batchNumber: String
        - reason: String
      }

      class StockReportQuery {
        - warehouseId: String
        - date: LocalDate
      }

      class StockReportItem {
        - productId: ProductCode
        - sku: String
        - name: String
        - currentStock: double
        - status: StockStatus
      }
    }

    package "facade" {
      class WarehouseFacade {
        - receiptUseCase: RegisterGoodsReceiptUseCase
        - shipmentUseCase: RegisterGoodsShipmentUseCase
        - writeOffUseCase: RegisterWriteOffUseCase
        - assignmentUseCase: StorageLocationAssignmentUseCase
        + receiveGoods(command: ReceiptCommand): Result<String>
        + shipGoods(command: ShipmentCommand): Result<String>
        + writeOffGoods(command: WriteOffCommand): Result<String>
        + assignLocation(command: AssignmentCommand): Result<LocationCoordinates>
        + getStockReport(query: StockReportQuery): List<StockReportItem>
      }
    }
  }

  package "domain" {
    package "model" {
      package "product" {
      class Product {
        - id: ProductCode
        - sku: String
        - name: String
        - category: String
        - unit: UnitOfMeasure
        - dimensions: ProductDimensions
        - stockLevels: StockThresholds
        + isBelowMinStock(currentQuantity: double): boolean
      }

      class ProductCode {
        - value: String
        + equals(other): boolean
      }

      class ProductDimensions {
        - weight: double
        - volume: double
      }

      class StockThresholds {
        - min: int
        - max: int
      }
    }

    package "writeoff" {
      class WriteOffDocument {
        - code: String
        - date: LocalDateTime
        - reason: String
        - responsiblePerson: String
        - status: WriteOffStatus
        - items: List<WriteOffLineItem>
        + addItem(item: WriteOffLineItem): void
        + approve(): void
        + getMovementEvents(): List<MovementRecordedEvent>
      }

      class WriteOffLineItem {
        - productId: ProductCode
        - quantity: double
        - batchNumber: String
        - reason: String
      }
    }

    package "location" {
      ' Компоновщик: StorageLocation и WarehouseSection
      class StorageLocation {
        - coordinates: LocationCoordinates
        - capacity: Capacity
        - occupied: double
        - batches: List<String>
        + getFreeSpace(): double
        + canStore(dimensions: ProductDimensions, quantity: double): boolean
        + assignBatch(batchNumber: String): void
        + releaseSpace(volume: double): void
        + addSubLocation(subLocation: StorageLocation): void
        + removeSubLocation(subLocation: StorageLocation): void
        + getChildLocations(): List<StorageLocation>
        + isComposite(): boolean
      }

      class WarehouseSection {
        - id: String
        - name: String
        - locations: List<StorageLocation>
        + addLocation(location: StorageLocation): void
        + removeLocation(location: StorageLocation): void
        + getLocations(): List<StorageLocation>
        + findAvailableSpace(dimensions: ProductDimensions, quantity: double): List<StorageLocation>
      }

      class LocationCoordinates {
        - zone: String
        - rack: String
        - shelf: String
        - level: int
        + toString(): String
        + equals(other): boolean
      }
    }
    }

    package "service" {
      ' Стратегия: LocationAssignmentService и его реализации
      interface LocationAssignmentService {
        + findOptimalLocation(dimensions: ProductDimensions, quantity: double): LocationCoordinates
      }

      class DefaultLocationAssignmentService {
        - locationRepository: LocationRepository
        + findOptimalLocation(dimensions, quantity): LocationCoordinates
      }

      class NearestLocationAssignmentStrategy {
        - locationRepository: LocationRepository
        + findOptimalLocation(dimensions, quantity): LocationCoordinates
      }

      class MaxFillLocationAssignmentStrategy {
        - locationRepository: LocationRepository
        + findOptimalLocation(dimensions, quantity): LocationCoordinates
      }

      class MovementService {
        - movementRepository: MovementRepository
        - eventPublisher: EventPublisher
        + recordReceiptMovement(productId: ProductCode, quantity: double, coordinates: LocationCoordinates): String
        + recordShipmentMovement(productId: ProductCode, quantity: double, coordinates: LocationCoordinates): String
        + recordWriteOffMovement(productId: ProductCode, quantity: double, coordinates: LocationCoordinates): String
        + getMovementHistory(productId: ProductCode, period: DateRange): List<MovementRecordedEvent>
        + validateMovement(productId: ProductCode, quantity: double, coordinates: LocationCoordinates, type: MovementType): boolean
      }

      class LocationAssignmentContext {
        - strategy: LocationAssignmentService
        + setStrategy(strategy: LocationAssignmentService): void
        + executeStrategy(dimensions: ProductDimensions, quantity: double): LocationCoordinates
      }

      interface InventoryService {
        + getCurrentStock(productId: ProductCode): double
        + checkStockLevels(): List<LowStockAlertEvent>
      }
    }

    package "event" {
      class MovementRecordedEvent {
        - movementId: String
        - type: MovementType
        - productId: ProductCode
        - quantity: double
        - timestamp: LocalDateTime
      }

      class BatchAssignedEvent {
        - batchNumber: String
        - coordinates: LocationCoordinates
        - productId: ProductCode
      }

      class LowStockAlertEvent {
        - productId: ProductCode
        - currentStock: double
        - minLevel: int
      }
    }

    package "repository" {
      interface ProductRepository {
        + findById(id: ProductCode): Optional<Product>
        + save(product: Product): void
      }

      interface LocationRepository {
        + findByCoordinates(coords: LocationCoordinates): Optional<StorageLocation>
        + findAvailableLocations(dimensions: ProductDimensions, quantity: double): List<StorageLocation>
        + save(location: StorageLocation): void
      }

      interface ReceiptRepository {
        + nextIdentity(): String
        + save(receipt: Receipt): void
      }

      interface WriteOffRepository {
        + nextIdentity(): String
        + save(writeOff: WriteOffDocument): void
        + findById(code: String): Optional<WriteOffDocument>
      }
    }
  }

  package "infrastructure" {
    package "persistence" {
      class GenericLocationRepository {
        - entityManager: EntityManager
        + findAvailableLocations(dimensions, quantity): List<StorageLocation>
      }

      class GenericMovementRepository {
        + record(movement: StockMovement): void
      }
    }
  }

  package "interfaces" {
    package "rest" {
      class WarehouseController {
        - facade: WarehouseFacade
        + receiveGoods(@RequestBody receiptDto: ReceiptDto): ResponseEntity
        + shipGoods(@RequestBody shipmentDto: ShipmentDto): ResponseEntity
        + writeOffGoods(@RequestBody writeOffDto: WriteOffDto): ResponseEntity
        + getStockReport(@RequestParam warehouse, @RequestParam date): ResponseEntity
      }
    }
  }
}

' Зависимости (Dependency)
WarehouseFacade ..> RegisterGoodsReceiptUseCase
WarehouseFacade ..> RegisterGoodsShipmentUseCase
WarehouseFacade ..> RegisterWriteOffUseCase
WarehouseFacade ..> StorageLocationAssignmentUseCase

RegisterGoodsReceiptUseCase ..> LocationAssignmentContext
RegisterGoodsReceiptUseCase ..> ReceiptRepository

RegisterWriteOffUseCase ..> InventoryService
RegisterWriteOffUseCase ..> WriteOffRepository
RegisterWriteOffUseCase ..> MovementService

StorageLocationAssignmentUseCase ..> LocationAssignmentContext
LocationAssignmentContext ..> LocationAssignmentService
DefaultLocationAssignmentService ..|> LocationAssignmentService
NearestLocationAssignmentStrategy ..|> LocationAssignmentService
MaxFillLocationAssignmentStrategy ..|> LocationAssignmentService

GenericLocationRepository ..|> LocationRepository

WarehouseController ..> WarehouseFacade

' Агрегация (Aggregation)
WarehouseSection o-- "0..*" StorageLocation
WriteOffDocument o-- "1..*" WriteOffLineItem

' Композиция (Composition)
Product *-- ProductDimensions
Product *-- StockThresholds

' Наследование/Реализация (Generalization)
DefaultLocationAssignmentService --|> LocationAssignmentService
NearestLocationAssignmentStrategy --|> LocationAssignmentService
MaxFillLocationAssignmentStrategy --|> LocationAssignmentService
GenericLocationRepository --|> LocationRepository

@enduml
```

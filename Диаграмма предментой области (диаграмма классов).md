![alt text](./assets/class.png)

```
@startuml

package "warehouse-management" {
  package "application" {
    package "usecase" {
      class RegisterGoodsReceiptUseCase {
        - receiptRepository: ReceiptRepository
        - locationService: LocationAssignmentService
        - movementService: MovementService
        - outbox: OutboxService
        + execute(command: ReceiptCommand): Result<ReceiptId>
      }

      class RegisterGoodsShipmentUseCase {
        - shipmentRepository: ShipmentRepository
        - inventoryService: InventoryService
        - movementService: MovementService
        + execute(command: ShipmentCommand): Result<ShipmentId>
      }

      class StorageLocationAssignmentUseCase {
        - locationRepository: LocationRepository
        - assignmentService: LocationAssignmentService
        + assignLocation(command: AssignmentCommand): Result<LocationId>
      }
    }

    package "dto" {
      class ReceiptCommand {
        - supplier: String
        - items: List<ReceiptItem>
        + validate(): ValidationResult
      }

      class ReceiptItem {
        - productId: ProductId
        - quantity: double
        - batchNumber: String
        - expiryDate: LocalDate
      }

      class StockReportQuery {
        - warehouseId: WarehouseId
        - date: LocalDate
      }

      class StockReportItem {
        - productId: ProductId
        - sku: String
        - name: String
        - currentStock: double
        - status: StockStatus
      }
    }

    package "facade" {
      class WarehouseFacade {
        - receiptUseCase: RegisterGoodsReceiptUseCase
        - shipmentUseCase: RegisterGoodsShipmentUseCase
        - assignmentUseCase: StorageLocationAssignmentUseCase
        + receiveGoods(command: ReceiptCommand): Result<ReceiptId>
        + shipGoods(command: ShipmentCommand): Result<ShipmentId>
        + assignLocation(command: AssignmentCommand): Result<LocationId>
        + getStockReport(query: StockReportQuery): List<StockReportItem>
      }
    }
  }

  package "domain" {
    package "model" {
      class Product {
        - id: ProductId
        - sku: SKU
        - name: String
        - category: String
        - unit: UnitOfMeasure
        - dimensions: ProductDimensions
        - stockLevels: StockThresholds
        + isBelowMinStock(currentQuantity: double): boolean
      }

      class StorageLocation {
        - id: LocationId
        - coordinates: LocationCoordinates
        - capacity: Capacity
        - occupied: double
        - batches: List<BatchId>
        + getFreeSpace(): double
        + canStore(dimensions: ProductDimensions, quantity: double): boolean
        + assignBatch(batch: InventoryBatch): void
        + releaseSpace(volume: double): void
      }

      class InventoryBatch {
        - id: BatchId
        - productId: ProductId
        - quantity: double
        - receivedAt: LocalDateTime
        - expiresAt: LocalDate
        - supplier: String
        + isExpired(now: LocalDate): boolean
        + split(quantity: double): InventoryBatch
      }

      class GoodsReceipt {
        - id: ReceiptId
        - date: LocalDateTime
        - supplier: String
        - status: ReceiptStatus
        - items: List<ReceiptLineItem>
        + addItem(item: ReceiptLineItem): void
        + confirm(): void
        + getMovementEvents(): List<MovementRecordedEvent>
      }

      class ReceiptLineItem {
        - batch: InventoryBatch
        - location: LocationId
        - quantity: double
      }
    }

    package "valueobject" {
      class ProductId {
        - value: UUID
        + equals(other): boolean
      }

      class LocationCoordinates {
        - zone: String
        - rack: String
        - shelf: String
        - level: int
      }

      class ProductDimensions {
        - weight: double
        - volume: double
      }

      class StockThresholds {
        - min: int
        - max: int
      }
    }

    package "service" {
      interface LocationAssignmentService {
        + findOptimalLocation(dimensions: ProductDimensions, quantity: double): LocationId
      }

      class DefaultLocationAssignmentService {
        - locationRepository: LocationRepository
        + findOptimalLocation(dimensions, quantity): LocationId
      }
    }

    package "event" {
      class MovementRecordedEvent {
        - movementId: MovementId
        - type: MovementType
        - productId: ProductId
        - quantity: double
        - timestamp: LocalDateTime
      }

      class BatchAssignedEvent {
        - batchId: BatchId
        - locationId: LocationId
        - productId: ProductId
      }
    }

    package "repository" {
      interface ProductRepository {
        + findById(id: ProductId): Optional<Product>
        + save(product: Product): void
      }

      interface LocationRepository {
        + findById(id: LocationId): Optional<StorageLocation>
        + findAvailableLocations(dimensions: ProductDimensions, quantity: double): List<StorageLocation>
        + save(location: StorageLocation): void
      }

      interface ReceiptRepository {
        + nextIdentity(): ReceiptId
        + save(receipt: GoodsReceipt): void
      }
    }
  }

  package "infrastructure" {
    package "persistence" {
      class JpaLocationRepository {
        - entityManager: EntityManager
        + findAvailableLocations(dimensions, quantity): List<StorageLocation>
      }

      class SpringDataMovementRepository {
        - jpaRepository: MovementJpaRepository
        + record(movement: StockMovement): void
      }
    }

    package "messaging" {
      class RabbitMqEventPublisher {
        - rabbitTemplate: RabbitTemplate
        + publish(event: DomainEvent): void
      }

      interface OutboxService {
        + schedule(event: DomainEvent, aggregateId: UUID): void
      }
    }
  }

  package "interfaces" {
    package "rest" {
      class WarehouseController {
        - facade: WarehouseFacade
        + receiveGoods(@RequestBody receiptDto: ReceiptDto): ResponseEntity
        + getStockReport(@RequestParam warehouse, @RequestParam date): ResponseEntity
      }
    }
  }
}

WarehouseFacade --> RegisterGoodsReceiptUseCase
WarehouseFacade --> RegisterGoodsShipmentUseCase
WarehouseFacade --> StorageLocationAssignmentUseCase

RegisterGoodsReceiptUseCase --> GoodsReceipt
RegisterGoodsReceiptUseCase --> LocationAssignmentService
RegisterGoodsReceiptUseCase --> ReceiptRepository

StorageLocationAssignmentUseCase --> DefaultLocationAssignmentService
DefaultLocationAssignmentService --> LocationRepository

GoodsReceipt "1" *-- "1..*" ReceiptLineItem
ReceiptLineItem --> InventoryBatch
ReceiptLineItem --> LocationId

StorageLocation "1" *-- "0..*" BatchId
Product --> StockThresholds
Product --> ProductDimensions

JpaLocationRepository ..|> LocationRepository
RabbitMqEventPublisher ..|> EventPublisher

WarehouseController --> WarehouseFacade

@enduml
```

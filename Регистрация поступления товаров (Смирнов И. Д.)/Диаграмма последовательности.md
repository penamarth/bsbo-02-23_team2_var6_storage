![alt text](../assets/reg.png)

```
@startuml
actor Кладовщик

participant UI
participant WarehouseSystemFacade
participant GoodsReceipt
participant Product
participant StorageLocation
participant ProductBatch
participant StockMovement
participant AccountingSystem
participant Database

Кладовщик-> UI: Выбирает "Регистрация поступления"
activate UI

UI -> WarehouseSystemFacade: GetReceiptForm()
activate WarehouseSystemFacade

WarehouseSystemFacade -> GoodsReceipt: CreateNewReceipt()
activate GoodsReceipt
GoodsReceipt --> WarehouseSystemFacade: New Receipt object
deactivate GoodsReceipt

WarehouseSystemFacade -> UI: Form data
deactivate WarehouseSystemFacade
UI --> Кладовщик: Отображает форму регистрации

deactivate UI
Кладовщик -> UI: Вводит данные поставщика и накладной
activate UI

UI -> WarehouseSystemFacade: RegisterSupplierInfo(supplier: String, invoiceNumber: String)
activate WarehouseSystemFacade

WarehouseSystemFacade -> GoodsReceipt: SetSupplierInfo(supplier, invoiceNumber)
activate GoodsReceipt
GoodsReceipt --> WarehouseSystemFacade: Confirmation
deactivate GoodsReceipt

WarehouseSystemFacade -> UI: Form updated
deactivate WarehouseSystemFacade
UI --> Кладовщик: Обновленная форма

deactivate UI
Кладовщик-> UI: Добавляет товарные позиции
activate UI

UI -> WarehouseSystemFacade: AddReceiptItems(items: List)
activate WarehouseSystemFacade

loop Для каждого товара
WarehouseSystemFacade -> Product: CheckProductExists(sku: String)
activate Product
Product --> WarehouseSystemFacade: Product info or error
deactivate Product

alt Товар не существует
WarehouseSystemFacade -> UI: Запрос на создание товара
activate UI
UI --> Кладовщик: Форма создания товара
Кладовщик -> UI: Ввод характеристик товара
UI -> WarehouseSystemFacade: CreateNewProduct(data: ProductData)
WarehouseSystemFacade -> Product: CreateProduct(data)
activate Product
Product --> WarehouseSystemFacade: New product created
deactivate Product
end

WarehouseSystemFacade -> StorageLocation: FindOptimalLocation(product: Product, quantity: double)
activate StorageLocation
StorageLocation --> WarehouseSystemFacade: List of available locations
deactivate StorageLocation

WarehouseSystemFacade -> GoodsReceipt: AddItem(product, quantity, batchNumber, location)
activate GoodsReceipt
GoodsReceipt --> WarehouseSystemFacade: Item added
deactivate GoodsReceipt
end

WarehouseSystemFacade -> UI: Confirmation of items added
deactivate WarehouseSystemFacade
UI --> Кладовщик: Подтверждение добавления позиций

deactivate UI
Кладовщик-> UI: Сохраняет поступление
activate UI

UI -> WarehouseSystemFacade: ConfirmReceipt()
activate WarehouseSystemFacade

WarehouseSystemFacade -> GoodsReceipt: ValidateAndConfirm()
activate GoodsReceipt
GoodsReceipt --> WarehouseSystemFacade: Validation result
deactivate GoodsReceipt

alt Проверка успешна
WarehouseSystemFacade -> StockMovement: CreateStockMovement(receipt)
activate StockMovement
StockMovement --> WarehouseSystemFacade: Movement created
deactivate StockMovement

WarehouseSystemFacade -> ProductBatch: CreateBatches(receiptItems)
activate ProductBatch
ProductBatch --> WarehouseSystemFacade: Batches created
deactivate ProductBatch

WarehouseSystemFacade -> StorageLocation: UpdateLocationOccupancy(receiptItems)
activate StorageLocation
StorageLocation --> WarehouseSystemFacade: Locations updated
deactivate StorageLocation

WarehouseSystemFacade -> AccountingSystem: SendReceiptData(receipt)
activate AccountingSystem
AccountingSystem --> WarehouseSystemFacade: Confirmation
deactivate AccountingSystem

WarehouseSystemFacade -> Database: SaveReceipt(receipt)
activate Database
Database --> WarehouseSystemFacade: Receipt saved
deactivate Database
else Ошибка проверки
WarehouseSystemFacade --> UI: Error details
deactivate WarehouseSystemFacade
UI --> Кладовщик: Показывает ошибки
deactivate UI
return
end

WarehouseSystemFacade -> UI: Receipt confirmation
deactivate WarehouseSystemFacade
UI --> Кладовщик: Показывает информацию о поступлении

deactivate UI
@enduml
```
